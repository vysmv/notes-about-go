# Область видимости в Go

Область видимости (scope) — это контекст в коде, в котором идентификатор (переменная, константа, функция, тип и т.д.) доступен для использования.

```go
package main

import "fmt"

var globalVar = "I am global"
var name = "Global name"

func main() {
    localVar := "I am local"
    fmt.Println(globalVar) // доступно
    fmt.Println(localVar)  // доступно

    {
        blockVar := "I am in a block"
        fmt.Println(blockVar) // доступно только здесь
    }

    // fmt.Println(blockVar) // Ошибка: undefined

	var name = "Local name" // Shadowing - Переопределение идентификатора в более внутренней области
	fmt.Println(name) // Local name
}
```

| Термин         | Значение                                                  |
| -------------- | --------------------------------------------------------- |
| **Identifier** | Имя переменной, функции, типа и т.д.                      |
| **Scope**      | Область, в которой идентификатор доступен                 |
| **Visibility** | Видимость идентификатора из других пакетов                |
| **Shadowing**  | Переопределение идентификатора в более внутренней области |
| **Exported**   | Доступен за пределами пакета (имя с заглавной буквы)      |
| **Unexported** | Виден только внутри пакета (имя со строчной буквы)        |


## Виды областей видимости

### Локальная область видимости (Local Scope)

> Переменные, объявленные внутри функции, метода или блока (if, for, switch), доступны только внутри этой области.

```go
func example() {
    a := 10 // локальная переменная

    if a > 5 {
        b := 20 // доступна только внутри этого блока
        fmt.Println(a, b)
    }

    // fmt.Println(b) // Ошибка: undefined: b
}
```

### Область пакета (Package Scope)

> Идентификаторы, объявленные вне функций, становятся доступными во всём файле и в других файлах того же пакета.

### Глобальная область видимости (Exported Identifiers)

> Переменные, функции, типы и методы с именем, начинающимся с заглавной буквы, становятся экспортируемыми и могут быть использованы в других пакетах через import.

Пример (в пакете utils):

```go
package utils

var ExportedVar = "This is exported"
var unexportedVar = "This is internal"
```

Использование:

```go
import "myproject/utils"

fmt.Println(utils.ExportedVar)     // OK
// fmt.Println(utils.unexportedVar) // Ошибка: неэкспортируемая переменная
```

### Блочная область (Block Scope)

> Это наиболее локальный тип области видимости. 
> В Go можно объявлять переменные внутри блоков {} — в if, for, switch, select, case, и даже в отдельных {}.
```go
func demo() {
    for i := 0; i < 3; i++ {
        x := i * 2
        fmt.Println(x)
    }
    // fmt.Println(x) // Ошибка: x вне области видимости
}
```

## Особенность: := и Shadowing

Go позволяет переменным затенять (shadow) другие переменные с тем же именем в более внешней области:
```go
func shadowExample() {
    x := 10
    if true {
        x := 20 // затеняет внешний x
        fmt.Println(x) // 20
    }
    fmt.Println(x) // 10
}
```

Если нужно именно переопределить значение переменной из более локальной области, то нужно использовать оператор `=`.

```go
package main

import "fmt"

func main() {
	var name string = "Ivan"

	if true {
		name = "New name"
	}

	fmt.Println(name) // New name
}
```

## Экспортируемость между пакетами

В Go заглавная первая буква идентификатора делает его экспортируемым — доступным за пределами текущего пакета.
Правила экспорта распространяются на: 

- переменных,
- функций,
- методов,
- структур,
- интерфейсов,
- констант.

## Видимость и структуры

Структура (struct) — это пользовательский тип, объединяющий несколько полей под одним именем. Поля могут иметь разную видимость.

Главное правило:

- Поле с заглавной буквы — экспортируемое (видно за пределами пакета)
- Поле со строчной буквы — неэкспортируемое (внутреннее)
```go
package user

type User struct {
    Name     string  // Экспортируемое поле
    password string  // Внутреннее поле
}
```

```go
// В другом пакете
import "project/user"

u := user.User{Name: "Alice"} // ✅ OK
u.Name = "Bob"                // ✅ OK
u.password = "12345"          // ❌ Ошибка: поле неэкспортируемое
```

## Инкапсуляция через методы

Go не имеет private/protected как в других языках, но инкапсуляция достигается через неэкспортируемые поля и методы доступа (get/set).

```go
type Account struct {
    balance float64 // неэкспортируемое поле
}

// Конструктор
func NewAccount(initial float64) *Account {
    return &Account{balance: initial}
}

// Экспортируемый метод
func (a *Account) Deposit(amount float64) {
    a.balance += amount
}

// Экспортируемый метод чтения
func (a *Account) Balance() float64 {
    return a.balance
}
```

```go
acc := NewAccount(100)
acc.Deposit(50)
fmt.Println(acc.Balance()) // ✅ 150
// acc.balance = 0        // ❌ нельзя: поле скрыто
```

## Вложенные структуры и видимость

Если в структуре есть вложенная структура, её поля наследуют свои правила видимости:
```go
type Address struct {
    Street string
    city   string
}

type Person struct {
    Name    string
    Address Address
}
```

```go
p := Person{
    Name: "John",
    Address: Address{
        Street: "Main St",
        city: "Boston", // ❌ невозможно установить вне пакета
    },
}
```

## Методы и экспорт
Экспорт метода зависит от имени метода, а не от имени типа.
```go
type Car struct{}

func (c Car) Drive() {}     // экспортируемый метод
func (c Car) refuel() {}    // неэкспортируемый метод
```

## Видимость интерфейса
Интерфейс (interface) — это набор сигнатур методов. Любой тип реализует интерфейс неявно, если у него есть нужные методы.

Как и везде в Go:

- Интерфейс с заглавной буквы — экспортируется из пакета.
- Интерфейс с маленькой буквы — доступен только в пакете.