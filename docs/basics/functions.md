# –§—É–Ω–∫—Ü–∏–∏ –≤ Go

–§—É–Ω–∫—Ü–∏—è ‚Äî —ç—Ç–æ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –≤—ã–∑–≤–∞–Ω –∏–∑ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã, —á—Ç–æ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é, —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞.


–ü—Ä–∏ –æ–ø–∏—Å–∞–Ω–∏–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏, –º—ã –º–æ–∂–µ–º —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∞ –≤–æ—Ç –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏, –º—ã –ø–µ—Ä–µ–¥–∞–µ–º –µ–π –∞—Ä–≥—É–º–µ–Ω—Ç—ã.
```go
package main

import (
    "fmt"
)

func sum(x, y int ) int {
    // –æ–ø–∏—Å—ã–≤–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä—É —É–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    return x + y
}

func main() {
    res := sum(2, 2) // –ø–µ—Ä–µ–¥–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
    fmt.Println(res)
}
```

## –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è**

```go
func sum(value float64) int {
    return int(value + 2)
}
```

**–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**

```go
func divide(a, b float64) (float64, error) {
    if b == 0 {
        return 0, fmt.Errorf("–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å")
    }
    return a / b, nil
}
```

**–ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**

```go
func calculate(a, b int) (sum int, product int) {
    sum = a + b
    product = a * b
    return // –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ –∏–º–µ–Ω–∞–º
}
```

–ù–æ —Ç—É—Ç –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –≤–æ–ø—Ä–æ—Å, –∑–∞—á–µ–º –≤–æ–æ–±—â–µ –Ω—É–∂–Ω—ã –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –µ—Å–ª–∏ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –º—ã –ø–æ—Ç–æ–º –ø—Ä–∏–Ω–∏–º–∞–µ–º –∏—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–º–µ–Ω–∞–º–∏?

–û—Ç–≤–µ—Ç:

1. –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏

```go
func rectangleProps(width, height float64) (area, perimeter float64) {
    area = width * height
    perimeter = 2 * (width + height)
    return // –∫–æ—Ä–æ—Ç–∫–∏–π return, –≤—Å—ë —É–∂–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–æ
}
```

**–ù–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å return area, perimeter ‚Äî –æ–Ω–∏ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.**

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ defer –∏–ª–∏ –ª–æ–≥–∏–∫–µ —Å recover()

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—ë—Ç —Ñ—É–Ω–∫—Ü–∏—è:

```go
func process() (result string) {
    defer func() {
        fmt.Println("–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:", result)
    }()
    result = "–ì–æ—Ç–æ–≤–æ"
    return
}
```

result –≤–∏–¥–µ–Ω –≤ defer, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ process. –ê defer-—Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –∑–∞–º—ã–∫–∞–Ω–∏—è, –æ–Ω–∏ –≤—Å–µ–≥–¥–∞ –≤–∏–¥—è—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã.

3. –ü–æ–ª–µ–∑–Ω–æ –≤ –¥–ª–∏–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –∏–ª–∏ –∫–æ–≥–¥–∞ return –Ω–µ –æ–¥–∏–Ω

```go
func fetchData() (data string, err error) {
    if problem {
        err = errors.New("–æ—à–∏–±–∫–∞") // data –æ—Å—Ç–∞—ë—Ç—Å—è –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π
        return                    // return "data", "err" => "", –æ—à–∏–±–∫–∞
    }

    data = "—É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç" // err –æ—Å—Ç–∞—ë—Ç—Å—è nil
    return                      // return "data", "err" => "—É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç", nil
}
```

–ù–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ —Ç—É—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ. –£–∫–∞–∑–∞–Ω–æ - —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–æ –ª–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º,  —á—Ç–æ –≤–µ—Ä–Ω–µ—Ç—Å—è –∏–ª —Ç–æ –∏–ª–∏ —Ç–æ.

–í—Å—è —Å—É—Ç—å –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏ –æ–±—å—è–≤–ª–µ–Ω–∏–∏ –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ –¥–≤—É—Ö –∏–º–µ–Ω–æ–≤–∞–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö, –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –æ–±—ã—á–Ω—ã–º–∏ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.

–í –∏—Ç–æ–≥–µ –µ—Å–ª–∏ –º—ã –∑–∞–π–¥–µ–º –≤ if, —Ç–æ –æ–ø—Ä–µ–¥–µ–ª–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è err, –∞ data –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π.

return –∂–µ –≤–µ—Ä–Ω–µ—Ç –∏—Ö –±–µ–∑ –ø—Ä—è–º–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è, –æ–ø–µ—Ä–∞—è—Å—å –Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—É.

4. –í–æ–∑–≤—Ä–∞—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

–ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
```go
type Shape interface {
    Area() float64
}

func getShape() Shape {
    return Circle{Radius: 10}
}
```

–¢—É—Ç –º—ã –≥–æ–≤–æ—Ä–∏–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Shape. –≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Circle –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π (–≥–¥–µ —Ç–æ –∑–∞ –∫—É–ª–∏—Å—Å–∞–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ Area).

–ù–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫:
```go
type Circle struct {
    Radius float64
}

func (c Circle) Area() float64 {
    return math.Pi * c.Radius * c.Radius
}
```

## –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```go
_, err := divide(10, 0)
if err != nil {
    fmt.Println("–û—à–∏–±–∫–∞:", err)
}
```

## –ê–Ω–æ–Ω–∏–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã)

–ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ª–∏—Ç–µ—Ä–∞–ª ‚Äî —ç—Ç–æ —Å–∏–Ω–æ–Ω–∏–º—ã –≤ —è–∑—ã–∫–µ Go.

> –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:
>
> Function literal ‚Äî —ç—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è func(...) { ... }, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—ë—Ç –∞–Ω–æ–Ω–∏–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, —Ç–æ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ func.

### –ß—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ª–∏—Ç–µ—Ä–∞–ª (–æ–Ω –∂–µ –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)?

–≠—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```go
func(x int) int {
    return x * 2
}
```

‚Äî —Å–æ–∑–¥–∞—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ func(int) int.

–≠—Ç–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

- –ù–µ –∏–º–µ–µ—Ç –∏–º–µ–Ω–∏
- –ú–æ–∂–µ—Ç –±—ã—Ç—å:
  - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑–≤–∞–Ω–∞

```go
var result = func(x int, y int) int {
   return x + y
}(3, 4)

fmt.Println(result) // 7
```


  - –ü—Ä–∏—Å–≤–æ–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
```go
var result = func(x int, y int) int {
    return x + y
}
```
  - –ü–µ—Ä–µ–¥–∞–Ω–∞ –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç
 ```go
 func apply(x int, f func(int) int) int {
     return f(x)
 }

 func main() {
     result := apply(5, func(y int) int {
     return y * y
})

fmt.Println(result) // 25
```
  - –í–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –∏–∑ –¥—Ä—É–≥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
```go
package main

import "fmt"

// makeMultiplier –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–æ–Ω–∏–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —É–º–Ω–æ–∂–∞–µ—Ç –Ω–∞ factor
func makeMultiplier(factor int) func(int) int {
    return func(x int) int {
        return x * factor
    }
}

func main() {
    times2 := makeMultiplier(2)
    times3 := makeMultiplier(3)

    fmt.Println(times2(5)) // 10
    fmt.Println(times3(5)) // 15
}
```

> –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
>
> - makeMultiplier ‚Äî –æ–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è factor int
> - –û–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–æ–Ω–∏–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Ç–∏–ø–∞ func(int) int
> - –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–º—ã–∫–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é factor
> - –í main() –º—ã –≤—ã–∑—ã–≤–∞–µ–º makeMultiplier(...) –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ times2, times3
> - –≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å

### –ì–¥–µ –º–æ–∂–Ω–æ –æ–±—ä—è–≤–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é?

–í–µ–∑–¥–µ –≥–¥–µ –¥–æ–ø—É—Å—Ç–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π.

## –ó–∞–º—ã–∫–∞–Ω–∏—è (closures)

–ó–∞–º—ã–∫–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è ¬´–∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç¬ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Å–≤–æ–µ–π –≤–Ω–µ—à–Ω–µ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ –Ω–µ—ë.

–í Go –∑–∞–º—ã–∫–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–Ω–æ–Ω–∏–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–∑–∂–µ.

### –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –∑–∞–º—ã–∫–∞–Ω–∏–µ –≤ Go?

```go
func makeCounter() func() int {
    count := 0
    return func() int {
        count++
        return count
    }
}

func main() {

    var foo = makeCounter()
    fmt.Println(foo()) // 1
    fmt.Println(foo()) // 2
}
```

 –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- makeCounter –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–æ–Ω–∏–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
- –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é count, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –≤–Ω–µ —Å–µ–±—è
- count ‚Äî –Ω–µ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∑–∞–º–∫–Ω—É—Ç–∞—è –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Ñ—É–Ω–∫—Ü–∏–∏

**–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è count –∂–∏–≤—ë—Ç, –ø–æ–∫–∞ –∂–∏–≤—ë—Ç —Ñ—É–Ω–∫—Ü–∏—è counter, —Ö–æ—Ç—è makeCounter() —É–∂–µ –¥–∞–≤–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å.**

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –∑–∞–º—ã–∫–∞–Ω–∏–π –≤ Go –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å PHP

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ Go –∑–∞–º—ã–∫–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

–ù–∞–ø—Ä–∏–º–µ—Ä:

```go
func main() {

    x := 42
    foo := func() {
        fmt.Println(x) // x ¬´–∑–∞–º–∫–Ω—É—Ç¬ª
    }

    x = 24

    foo() // 24
}
```

–í PHP –∂–µ –ø —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–º—ã–∫–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ ,—Ç–æ –µ—Å—Ç—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–ø–∏—è.

–ù–∞–ø—Ä–∏–º–µ—Ä:
```go
$x = 42;

$foo = function() use($x) {
    echo $x;
};

$x = 24;

$foo(); // 42
```

–ù–æ –º—ã –º–æ–∂–µ–º –ø–æ–º–µ–Ω—è—Ç—å —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö.

–ù–∞–ø—Ä–∏–º–µ—Ä PHP –ø–æ —Å—Å—ã–ª–∫–µ:
```go
$x = 42;

$foo = function() use(&$x) {
    echo $x;
};

$x = 24;

$foo(); // 24
```

–∏–ª–∏ Go –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é:
```go
x := 42
y := x // –≤—Ä—É—á–Ω—É—é –∫–æ–ø–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–æ –µ—Å—Ç—å —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

foo := func() {
    fmt.Println(y) // —Ç–µ–ø–µ—Ä—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –∫–æ–ø–∏—è
}

x = 24

foo() // üëâ 42
```

–ù–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –º—ã –ø—Ä–æ—Å—Ç–æ —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ y.

## Defer

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º ,–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–º—ã defer –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Å–≤–æ–∏—Ç—å, —á—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö stack.
–°—Ç–µ–∫ —ç—Ç–æ –∫–æ–≥–¥–∞ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∞–¥—É—Ç—Å—è —Å–≤–µ—Ä—Ö—É –∏ –∑–∞–±–∏—Ä–∞—é—Ç—Å—è —Å–≤–µ—Ä—Ö—É. –¢–æ –µ—Å—Ç—å –ø–µ—Ä–≤—ã–º –ø—Ä–∏—à–µ–ª, –ø–æ—Å–ª–µ–¥–Ω–∏–º —É—à–µ–ª.

defer - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –≤—ã–∑—ã–≤–∞–µ–º—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –±—É–¥—å —Ç–æ:

- –æ–±—ã—á–Ω—ã–µ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏,
- –º–µ—Ç–æ–¥—ã,
- –∞–Ω–æ–Ω–∏–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã),
- —Ñ—É–Ω–∫—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π,
- –∏ –¥–∞–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ (recover, close –∏ —Ç.–ø.).

1. –û–±—ã—á–Ω–∞—è –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
```go
func cleanup() {
    fmt.Println("cleanup called")
}

func main() {
    defer cleanup() // ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
}
```

2. –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
```go
func main() {
    defer func() {
        fmt.Println("deferred anon func")
    }()
}
```

3. –ú–µ—Ç–æ–¥
```go
type File struct{}

func (f *File) Close() {
    fmt.Println("File closed")
}

func main() {
    f := &File{}
    defer f.Close() // ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
}
```

4. –í—ã–∑–æ–≤ –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
```go
func getFunc() func() {
    return func() {
        fmt.Println("from returned function")
    }
}

func main() {
    defer getFunc()() // ‚úÖ —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
}
```

5. –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
```go
func main() {
    defer fmt.Println("end") // ‚úÖ –º–æ–∂–Ω–æ –¥–∞–∂–µ defer'–∏—Ç—å –≤—ã–∑–æ–≤ fmt.Println
}
```

–í —è–∑—ã–∫–µ Go –æ–ø–µ—Ä–∞—Ç–æ—Ä defer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏. –í—ã–∑–æ–≤, –ø–æ–º–µ—á–µ–Ω–Ω—ã–π defer, –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ –º–æ–º–µ–Ω—Ç –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏–∑–æ—à—ë–ª –≤—ã—Ö–æ–¥ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏–ª–∏ —á–µ—Ä–µ–∑ panic).

–ù–∞–ø—Ä–∏–º–µ—Ä:
```go
func main() {
    fmt.Println("start")
    defer fmt.Println("deferred")
    fmt.Println("end")
}
```

–í—ã–≤–æ–¥:
```bash
start
end
deferred
```

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ defer, –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (LIFO\stack) ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–º –æ–±—ä—è–≤–ª–µ–Ω ‚Üí –ø–µ—Ä–≤—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω:
```go
func main() {
    defer fmt.Println("1")
    defer fmt.Println("2")
    defer fmt.Println("3")
}
```

–í—ã–≤–æ–¥:
```go
3
2
1
```

–¢–æ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑–≤–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ defer f() —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ —Å—Ç–µ–∫.

### –ö–æ–≥–¥–∞ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç—ã?

–ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏, —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤ defer, –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –∞ —Å–∞–º–∞ —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –ø–æ–∑–∂–µ.
```go
func say(msg string) {
    fmt.Println(msg)
}

func main() {
    msg := "hello"
    defer say(msg)
    msg = "world"
}
```

–í—ã–≤–æ–¥:
```bash
hello
```

**–ü–æ—Ç–æ–º—É —á—Ç–æ msg –≤—ã—á–∏—Å–ª–µ–Ω –Ω–∞ –º–æ–º–µ–Ω—Ç defer, –∞ –Ω–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞.**

### –ü—Ä–∏–º–µ—Ä —Å –ø–æ–±–æ—á–Ω—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º

```go
func main() {
    defer fmt.Println("result:", compute())
}

func compute() int {
    fmt.Println("compute() called")
    return 42
}
```

–í—ã–≤–æ–¥:
```bash
compute() called
result: 42
```

**compute() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É, fmt.Println(...) ‚Äî –ø–æ–∑–∂–µ.**

### –ß–∞—Å—Ç–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

–ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:

```go
f, _ := os.Open("file.txt")
defer f.Close()
```